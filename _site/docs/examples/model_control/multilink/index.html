<!DOCTYPE html>
<html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<link rel="shortcut icon" href="/SorotokiPage/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/SorotokiPage/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/SorotokiPage/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/SorotokiPage/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1">
<title>(1) Simulating a multi-link soft manipulator (PCC) | SOROTOKI</title>
<meta name="generator" content="Jekyll v3.9.2">
<meta property="og:title" content="(1) Simulating a multi-link soft manipulator (PCC)">
<meta property="og:locale" content="en_US">
<meta name="description" content="A Soft Robotics Toolkit for MATLAB">
<meta property="og:description" content="A Soft Robotics Toolkit for MATLAB">
<link rel="canonical" href="http://localhost:4000/SorotokiPage/docs/examples/model_control/multilink/">
<meta property="og:url" content="http://localhost:4000/SorotokiPage/docs/examples/model_control/multilink/">
<meta property="og:site_name" content="SOROTOKI">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="(1) Simulating a multi-link soft manipulator (PCC)"> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"A Soft Robotics Toolkit for MATLAB","headline":"(1) Simulating a multi-link soft manipulator (PCC)","url":"http://localhost:4000/SorotokiPage/docs/examples/model_control/multilink/"}</script> <script src="https://kit.fontawesome.com/b6cba8db77.js" crossorigin="anonymous"></script>
<script>MathJax={"tex":{"inlineMath":[["$","$"],["\\(","\\)"]],"displayMath":[["$$","$$"],["\\[","\\]"]]},"svg":{"fontCache":"global"}}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewbox="0 0 24 24"><title>Link</title>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewbox="0 0 24 24"><title>Search</title>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewbox="0 0 24 24"><title>Menu</title>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewbox="0 0 24 24"><title>Expand</title>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewbox="0 0 24 24"><title>Document</title>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg><div class="side-bar">
<div class="site-header"> <a href="http://localhost:4000/SorotokiPage/" class="site-title lh-tight"> SOROTOKI </a> <a href="#" id="menu-button" class="site-button"> <svg viewbox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a>
</div>
<nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list">
<li class="nav-list-item"><a href="http://localhost:4000/SorotokiPage/" class="nav-list-link">Home</a></li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/SorotokiPage/docs/documentation" class="nav-list-link">Documentation</a><ul class="nav-list ">
<li class="nav-list-item "><a href="http://localhost:4000/SorotokiPage/docs/documentation/introduction.html" class="nav-list-link">About SOROTOKI</a></li>
<li class="nav-list-item "><a href="http://localhost:4000/SorotokiPage/docs/documentation/install.html" class="nav-list-link">Installation guide</a></li>
<li class="nav-list-item "><a href="http://localhost:4000/SorotokiPage/docs/documentation/guide.html" class="nav-list-link">User functions</a></li>
</ul>
</li>
<li class="nav-list-item active">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/SorotokiPage/docs/examples" class="nav-list-link">Examples</a><ul class="nav-list ">
<li class="nav-list-item ">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/SorotokiPage/docs/examples/design.html" class="nav-list-link">Design and Analysis</a><ul class="nav-list">
<li class="nav-list-item "> <a href="http://localhost:4000/SorotokiPage/docs/examples/design/pull/" class="nav-list-link">(1) Material test</a>
</li>
<li class="nav-list-item "> <a href="http://localhost:4000/SorotokiPage/docs/examples/design/pneufem/" class="nav-list-link">(2) Finite element analysis of PneuNet</a>
</li>
<li class="nav-list-item "> <a href="http://localhost:4000/SorotokiPage/docs/examples/design/pneunet/" class="nav-list-link">(3) Automated design synthesis of PneuNet</a>
</li>
</ul>
</li>
<li class="nav-list-item active">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/SorotokiPage/docs/examples/model_control.html" class="nav-list-link">Modeling and Control</a><ul class="nav-list">
<li class="nav-list-item active"> <a href="http://localhost:4000/SorotokiPage/docs/examples/model_control/multilink/" class="nav-list-link active">(1) Simulating a multi-link soft manipulator (PCC)</a>
</li>
<li class="nav-list-item "> <a href="http://localhost:4000/SorotokiPage/docs/documentation/examples/design/control/" class="nav-list-link">(2) Energy-based control of octopus soft arm</a>
</li>
<li class="nav-list-item "> <a href="http://localhost:4000/SorotokiPage/docs/examples/model_control/dynfem" class="nav-list-link">(3) Geometry-informed variable strain models</a>
</li>
</ul>
</li>
<li class="nav-list-item ">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/SorotokiPage/docs/examples/graphics.html" class="nav-list-link">Computer Graphics</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/SorotokiPage/docs/examples/graphics/renderstl/" class="nav-list-link">Example 1 - Rendering the Stanford Bunny (.stl)</a>
</li></ul>
</li>
</ul>
</li>
<li class="nav-list-item"><a href="http://localhost:4000/SorotokiPage/docs/contact.html" class="nav-list-link">Contact</a></li>
<li class="nav-list-item"><a href="http://localhost:4000/SorotokiPage/docs/cite.html" class="nav-list-link">How to cite?</a></li>
<li class="nav-list-item"><a href="http://localhost:4000/SorotokiPage/docs/patch.html" class="nav-list-link">Patch notes</a></li>
</ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer>
</div>
<div class="main" id="top">
<div id="main-header" class="main-header">
<div class="search">
<div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search SOROTOKI" aria-label="Search SOROTOKI" autocomplete="off"> <label for="search-input" class="search-label"><svg viewbox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
</div>
<div id="search-results" class="search-results"></div>
</div>
<nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="https://github.com/BJCaasenbrood/SorotokiCode" class="site-button"> SOROTOKI on GitHub </a>
</li></ul></nav>
</div>
<div id="main-content-wrap" class="main-content-wrap">
<nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list">
<li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/SorotokiPage/docs/examples">Examples</a></li>
<li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/SorotokiPage/docs/examples/model_control.html">Modeling and Control</a></li>
<li class="breadcrumb-nav-list-item"><span>(1) Simulating a multi-link soft manipulator (PCC)</span></li>
</ol></nav><div id="main-content" class="main-content" role="main"> <script> MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] }, svg: { fontCache: 'global' } }; </script> <script type="text/javascript" id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"> </script><h1 class="no_toc" id="simulating-the-dynamics-of-a-multi-link-soft-robot-manipulator-pcc-approach"> <a href="#simulating-the-dynamics-of-a-multi-link-soft-robot-manipulator-pcc-approach" class="anchor-heading" aria-labelledby="simulating-the-dynamics-of-a-multi-link-soft-robot-manipulator-pcc-approach"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Simulating the dynamics of a multi-link soft robot manipulator (PCC approach)</h1>
<details open=""> <summary class="text-delta"> Table of contents </summary><ol id="markdown-toc">
<li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li>
<li><a href="#strain-parameterization" id="markdown-toc-strain-parameterization">Strain parameterization</a></li>
<li><a href="#material-assignment" id="markdown-toc-material-assignment">Material assignment</a></li>
<li><a href="#constructing-the-model-class" id="markdown-toc-constructing-the-model-class">Constructing the Model class</a></li>
<li><a href="#assigning-a-controller" id="markdown-toc-assigning-a-controller">Assigning a controller</a></li>
<li><a href="#simulating-the-closed-loop-system" id="markdown-toc-simulating-the-closed-loop-system">Simulating the closed-loop system</a></li>
<li><a href="#complete-code" id="markdown-toc-complete-code">Complete code</a></li>
</ol></details><hr>
<h4 class="no_toc" id="difficulty-intermediate"> <a href="#difficulty-intermediate" class="anchor-heading" aria-labelledby="difficulty-intermediate"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Difficulty: <code class="language-plaintext fs-3 text-green-200 highlighter-rouge">intermediate</code>
</h4>
<ul>
<li>Required classes: <code class="language-plaintext text-purple-000 highlighter-rouge">Shapes.m</code>, <code class="language-plaintext text-purple-000 highlighter-rouge">Model.m</code>, <code class="language-plaintext text-purple-000 highlighter-rouge">Rig.m</code>
</li>
<li>Code length: <code class="language-plaintext text-purple-000 highlighter-rouge">~25 lines</code> (without comments)</li>
</ul>
<hr>
<h3 id="introduction"> <a href="#introduction" class="anchor-heading" aria-labelledby="introduction"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Introduction</h3>
<p>In the following example, we will build a multi-link soft robot manipulator, similar to Festo’s Bionic Handling Assistant as shown below. The system consists of three pneumatic segments, which we will model according the <em>Piecewise-Constant-Curvature</em> description – PCC in short. SOROTOKI comes equipped with two Classes: <code class="language-plaintext text-purple-000 highlighter-rouge">Shapes.m</code> and <code class="language-plaintext text-purple-000 highlighter-rouge">Model.m</code> which take care of the spatial strain parameterization and the continuum dynamic model, respectively. Furthermore, <code class="language-plaintext text-purple-000 highlighter-rouge">Shapes.m</code> will also contain the physical properties of the spatial beam, such as density, stiffness, and damping coefficients. Once the dynamic trajectories of the system are solved using <code class="language-plaintext text-purple-000 highlighter-rouge">Model.m</code>, we can call <code class="language-plaintext text-purple-000 highlighter-rouge">Rig.m</code> to assign an kinematic rig for 3D-graphical models. The resulting simulations is produced using SOROTOKI:</p>
<div align="center"> <img src="./img/intro.jpg" width="500">
</div>
<div align="center"> Festo's Bionic Handling Assistant inspired by the elphant's trunk (see [1])</div>
<div align="center"> <img src="./img/mdl_threelink.gif" width="500">
</div>
<div align="center"> Three-link soft robot manipulator dynamics using SOROTOKI based on the Festo's Bionic Handling Assistant. The model's state dimension is $\dim(q) = 6$ that is two unique $x-z$ and $y-z$ curvatures per soft-link segment.</div>
<h3 id="strain-parameterization"> <a href="#strain-parameterization" class="anchor-heading" aria-labelledby="strain-parameterization"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Strain parameterization</h3>
<p>To describe the spatial evolution of the soft robot, we use the class <code class="language-plaintext text-purple-000 highlighter-rouge">Shapes.m</code>. The input for the class is a matrix $Y$ of size $N \times M$, where $N$ is the number of spatial discretizations (i.e., the number of nodes along the spatial curve) and $M$ the number of unique modes. Note that the columns of $Y$ correspond to the spatial modes of the soft robotic model.</p>
<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">%% spatial parameterization</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">360</span><span class="p">;</span>  <span class="c1">% intrinsic length of soft robot</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">300</span><span class="p">;</span>  <span class="c1">% number of spatial nodes</span>

<span class="c1">% construct spatial parameters X</span>
<span class="n">X</span> <span class="o">=</span> <span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="o">'</span><span class="p">;</span>
<span class="n">Y</span> <span class="o">=</span> <span class="p">[];</span>

<span class="c1">% constructing the shape function matrix evaluated for X</span>
<span class="k">for</span> <span class="n">ii</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">M</span>
   <span class="n">Y</span><span class="p">(:,</span><span class="n">ii</span><span class="p">)</span> <span class="o">=</span> <span class="n">pcc</span><span class="p">(</span><span class="n">X</span><span class="p">/</span><span class="n">L</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">M</span><span class="p">);</span> <span class="c1">% PCC </span>
<span class="k">end</span>

<span class="c1">% generate Shapes class</span>
<span class="n">shp</span> <span class="o">=</span> <span class="n">Shapes</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">Modes</span><span class="p">,</span><span class="s1">'L0'</span><span class="p">,</span><span class="n">L</span><span class="p">);</span> <span class="c1">% construct shape class</span>
<span class="n">shp</span><span class="o">.</span><span class="nb">show</span><span class="p">();</span>                   <span class="c1">% displays the columns of Y</span>
</code></pre></div></div>
<p>The code above should produce the following:</p>
<div align="center"> <img src="./img/shapes.png" width="550">
</div>
<div align="center"> Shape functions of the three-link soft robot -- a three segmented piecewise constant strain.</div>
<p><strong>Note:</strong> By default, inputting an matrix into <code class="language-plaintext text-purple-000 highlighter-rouge">Shapes</code> will ensure each column is mutually orthogonal using the Gram-Schmidt orthogonalization procedure, see <a href="https://en.wikipedia.org/wiki/Gram%E2%80%93Schmidt_process">[2]</a>. In other words, the integral $\int_0^L Y_i^\top Y_j \; d\sigma $ will be $1$ for indices $i = j$, and $0$ otherwise. Naturally, this ensure the spatial modes are decoupled from a compliance perspective.</p>
<p><strong>Note:</strong> Second, notice we specify <code class="language-plaintext text-purple-000 highlighter-rouge">Shapes(...,'L0',L)</code>. This ensure the intrinsic length of the curve is equal to $L$. By default, the intrinsic length is set to $L = 1$ if not adjusted by the user.</p>
<h2 id="material-assignment"> <a href="#material-assignment" class="anchor-heading" aria-labelledby="material-assignment"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Material assignment</h2>
<p>Analogous to the finite element class, we can assign materials using <code class="language-plaintext text-purple-000 highlighter-rouge">Shapes.Material</code>. Here, let us consider a Neo-Hookean material with Young’s modulus $E = 10$ MPa and poisson ratio $\nu = 0.4$. We also change the density to $\rho = 150 $ kg/m$^3$ which translates to <code class="language-plaintext text-purple-000 highlighter-rouge">Shapes.Material.Rho = 150e-12</code> as SOROTOKI uses unit millimeters (mm). After those assignments, we set the gravitational component using <code class="language-plaintext text-purple-000 highlighter-rouge">Shapes.Gvec</code>. Once all physical properties are set, make sure to rebuild the necessary material tensors using <code class="language-plaintext text-purple-000 highlighter-rouge">shp.rebuild()</code>.</p>
<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">%% setting Neo-Hookean material</span>
<span class="n">shp</span><span class="o">.</span><span class="n">Material</span> <span class="o">=</span> <span class="n">NeoHookeanMaterial</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mf">0.4</span><span class="p">);</span>

<span class="c1">% overwriting properties</span>
<span class="n">shp</span><span class="o">.</span><span class="n">Material</span><span class="o">.</span><span class="n">Rho</span> <span class="o">=</span> <span class="mf">150e-12</span><span class="p">;</span>    <span class="c1">% setting density</span>
<span class="n">shp</span><span class="o">.</span><span class="n">Gravity</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">9.81e3</span><span class="p">;</span> <span class="mi">0</span><span class="p">;</span> <span class="mi">0</span><span class="p">];</span> <span class="c1">% setting gravity</span>

<span class="c1">% rebuild material tensors</span>
<span class="n">shp</span> <span class="o">=</span> <span class="n">shp</span><span class="o">.</span><span class="n">rebuild</span><span class="p">();</span>
</code></pre></div></div>
<h2 id="constructing-the-model-class"> <a href="#constructing-the-model-class" class="anchor-heading" aria-labelledby="constructing-the-model-class"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Constructing the Model class</h2>
<p>Once the shapes and the physical parameters of the curve are set, we can construct the model class. To do so, we simply input the <code class="language-plaintext text-purple-000 highlighter-rouge">shp</code> into <code class="language-plaintext text-purple-000 highlighter-rouge">Model.m</code>. We also have to specify which Degrees-of-freedom we want to have enabled for the curve. Consider the vector <code class="language-plaintext text-purple-000 highlighter-rouge">Modes = [kxx,kxz,kyz,exx,exz,eyz]</code> where <code class="language-plaintext text-purple-000 highlighter-rouge">[kxx,kxz,kyz]</code> are the twist and curvatures modes, and <code class="language-plaintext text-purple-000 highlighter-rouge">[exx,exz,eyz]</code> the elongation and shear modes. Since we consider a system undergoing pure bending specified by three PCC functions, we have <code class="language-plaintext text-purple-000 highlighter-rouge">Modes = [0,kxz,kyz,0,0,0]</code> with <code class="language-plaintext text-purple-000 highlighter-rouge">kxz = kyz = 3</code>.</p>
<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">% generating Model class</span>
<span class="n">Modes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>   <span class="c1">% DOFs of the curve, i.e., only pure bending</span>
<span class="n">mdl</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">shp</span><span class="p">,</span><span class="n">Modes</span><span class="p">);</span> <span class="c1">% model class</span>
</code></pre></div></div>
<p><strong>Important!</strong> Note that the number of modes per DOF must corresponds to the number of columns of the matrix $Y$. let it be clear that the curvatures <code class="language-plaintext text-purple-000 highlighter-rouge">kxy</code> and <code class="language-plaintext text-purple-000 highlighter-rouge">kyz</code> do not have to share the same spatial description <code class="language-plaintext text-purple-000 highlighter-rouge">Y</code>, as such, we can enrich the <code class="language-plaintext text-purple-000 highlighter-rouge">Shapes</code> class by <code class="language-plaintext text-purple-000 highlighter-rouge">shp = Shapes([Y1,Y2])</code> where <code class="language-plaintext text-purple-000 highlighter-rouge">Y1</code> and <code class="language-plaintext text-purple-000 highlighter-rouge">Y2</code> correspond to the spatial modes related to the curvatures <code class="language-plaintext text-purple-000 highlighter-rouge">kxy</code> and <code class="language-plaintext text-purple-000 highlighter-rouge">kyz</code>, respectively.</p>
<h2 id="assigning-a-controller"> <a href="#assigning-a-controller" class="anchor-heading" aria-labelledby="assigning-a-controller"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Assigning a controller</h2>
<p>The advantage of SOROTOKI is its own ODE solver that allows for easy controller development. To be more specific, the function which computes the generalized forces acting on the soft robot, given by <code class="language-plaintext text-purple-000 highlighter-rouge">Model.tau</code>, can be overwritten by the user as to specify the torques a every timestep. For each function call, the solver will the class itself into <code class="language-plaintext text-purple-000 highlighter-rouge">Model.tau</code>. Let us clarify why this is important, by considering the following example:</p>
<p>Suppose we want to develop an PD+ controller, that is, a Proportional-Derivative controller that compensates gravity and stiffness. Given the error $e:=q - q_d$, the PD+ controller has the following form:</p>
<p>$$\tau = \nabla_{q}\;\mathcal{U}(q) - K_p e - K_d \dot{e} $$</p>
<p>where we choose $K_p = k_1 K_T$ with tangent stiffness $K_T = \nabla^2_{q}\;\mathcal{U}_e(q)$, and $K_d = k_2 M$ with $M(q)$ the generalized inertia matrix; and $k_1,k_2 &gt; 0$ control gains. For simplicity, lets consider the following controller gains: $k_1 = k_2 = 1$. To construct the controller in SOROTOKI, consider the following:</p>
<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">% desired joint configuration</span>
<span class="n">qd</span> <span class="o">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">shp</span><span class="o">.</span><span class="n">NDim</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">qd</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">+</span><span class="mf">5e-3</span><span class="p">;</span> <span class="c1">% curvature in 1/mm  </span>
<span class="n">qd</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5e-3</span><span class="p">;</span> <span class="c1">% curvature in 1/mm   </span>
<span class="n">qd</span><span class="p">(</span><span class="mi">5</span><span class="p">,:)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">7e-3</span><span class="p">;</span> <span class="c1">% curvature in 1/mm  </span>
<span class="n">qd</span><span class="p">(</span><span class="mi">6</span><span class="p">,:)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">7e-3</span><span class="p">;</span> <span class="c1">% curvature in 1/mm  </span>

<span class="c1">% assign controller</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="o">@</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="n">Controller</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">qd</span><span class="p">)</span>

<span class="c1">% auxiliary function for controller</span>
<span class="k">function</span> <span class="n">tau</span> <span class="o">=</span> <span class="n">Controller</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span><span class="n">Qd</span><span class="p">)</span>
  <span class="n">q</span>  <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">q</span><span class="p">;</span>   <span class="c1">% get q(t)</span>
  <span class="n">dq</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">dq</span><span class="p">;</span>  <span class="c1">% get dq(t)</span>

  <span class="n">Kp</span>  <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">EL</span><span class="o">.</span><span class="n">K</span><span class="p">;</span>     <span class="c1">% tangent stiffness matrix</span>
  <span class="n">Kd</span>  <span class="o">=</span> <span class="n">KT</span><span class="o">*</span><span class="n">mdl</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">EL</span><span class="o">.</span><span class="n">M</span><span class="p">;</span>  <span class="c1">% inertia matrix</span>

  <span class="c1">% switching set-point</span>
  <span class="k">if</span> <span class="n">mdl</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">t</span> <span class="o">&lt;</span> <span class="mi">5</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">q</span> <span class="o">-</span> <span class="n">Qd</span><span class="p">(:,</span><span class="mi">1</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">q</span> <span class="o">-</span> <span class="n">Qd</span><span class="p">(:,</span><span class="mi">2</span><span class="p">);</span>
  <span class="k">end</span>

  <span class="c1">% PD+ control law</span>
  <span class="n">tau</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">dUdq</span> <span class="o">-</span> <span class="n">Kp</span><span class="o">*</span><span class="n">e</span> <span class="o">-</span> <span class="n">Kd</span><span class="o">*</span><span class="n">dq</span><span class="p">;</span>
<span class="k">end</span>
</code></pre></div></div>
<h2 id="simulating-the-closed-loop-system"> <a href="#simulating-the-closed-loop-system" class="anchor-heading" aria-labelledby="simulating-the-closed-loop-system"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Simulating the closed-loop system</h2>
<p>Now, we only have to simulate the system. Let us consider a finite horizon time of $T = 10$ s with timesteps $\Delta t = 10$ ms. Then, we can simulate the closed-loop model as follows:</p>
<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">% set solver setttings</span>
<span class="n">mdl</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="s1">'TimeEnd'</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="s1">'TimeStep'</span><span class="p">,</span><span class="mf">10e-3</span><span class="p">);</span>

<span class="c1">% simulate!</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">simulate</span><span class="p">();</span>

<span class="c1">% plotting</span>
<span class="nb">figure</span><span class="p">(</span><span class="mi">99</span><span class="p">);</span> 
<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> 
<span class="nb">plot</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">mdl</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">q</span><span class="p">,</span><span class="s1">'Linew'</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> <span class="nb">hold</span> <span class="n">on</span><span class="p">;</span>
<span class="nb">plot</span><span class="p">([</span><span class="mi">0</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">10</span><span class="p">],[</span><span class="n">qd</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">qd</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">qd</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="n">qd</span><span class="p">(:,</span><span class="mi">2</span><span class="p">)],</span><span class="s1">'k--'</span><span class="p">,</span><span class="s1">'Linew'</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

<span class="nb">title</span><span class="p">(</span><span class="s1">'states $q$'</span><span class="p">,</span><span class="s1">'interpreter'</span><span class="p">,</span><span class="s1">'latex'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">'</span><span class="p">,</span><span class="mi">21</span><span class="p">)</span>
<span class="nb">grid</span> <span class="n">on</span><span class="p">;</span> 

<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> <span class="nb">plot</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">mdl</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="s1">'Linew'</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'momenta $p = M(q)\dot{q}$'</span><span class="p">,</span><span class="s1">'interpreter'</span><span class="p">,</span><span class="s1">'latex'</span><span class="p">,</span><span class="s1">'fontsize'</span><span class="p">,</span><span class="mi">21</span><span class="p">);</span>
<span class="nb">grid</span> <span class="n">on</span><span class="p">;</span> 
</code></pre></div></div>
<div align="center"> <img src="./img/states.png" width="600">
</div>
<div align="center"> Evolution of the states and generalized momenta of the closed-loop soft robotic system. The dashed black lines denote the desired state configurations $q_d$.</div>
<h2 id="complete-code"> <a href="#complete-code" class="anchor-heading" aria-labelledby="complete-code"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Complete code</h2>
<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">L</span> <span class="o">=</span> <span class="mi">360</span><span class="p">;</span>   <span class="c1">% length of robot</span>
<span class="n">M</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>     <span class="c1">% number of modes</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">300</span><span class="p">;</span>   <span class="c1">% number of discrete points on curve</span>
<span class="n">H</span> <span class="o">=</span> <span class="mi">1</span><span class="p">/</span><span class="mi">60</span><span class="p">;</span>  <span class="c1">% timesteps</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>  <span class="c1">% animation speed</span>

<span class="n">Modes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span>  <span class="c1">% pure-XY curvature</span>

<span class="c1">%% generate shapes</span>
<span class="n">X</span>   <span class="o">=</span> <span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="o">'</span><span class="p">;</span>

<span class="n">Y</span> <span class="o">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">);</span>
<span class="k">for</span> <span class="n">ii</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">M</span>
   <span class="n">Y</span><span class="p">(:,</span><span class="n">ii</span><span class="p">)</span> <span class="o">=</span> <span class="n">pcc</span><span class="p">(</span><span class="n">X</span><span class="p">/</span><span class="n">L</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">M</span><span class="p">);</span> <span class="c1">% pcc</span>
<span class="k">end</span>

<span class="n">shp</span> <span class="o">=</span> <span class="n">Shapes</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">Modes</span><span class="p">,</span><span class="s1">'L0'</span><span class="p">,</span><span class="n">L</span><span class="p">);</span>

<span class="c1">%% setting materials</span>
<span class="n">shp</span><span class="o">.</span><span class="n">Material</span> <span class="o">=</span> <span class="n">NeoHookeanMaterial</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mf">0.4</span><span class="p">);</span>
<span class="n">shp</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="s1">'Rho'</span><span class="p">,</span><span class="mf">150e-12</span><span class="p">,</span><span class="k">...</span>
        <span class="s1">'Gravity'</span><span class="p">,[</span><span class="o">-</span><span class="mf">9.81e3</span><span class="p">;</span> <span class="mi">0</span><span class="p">;</span> <span class="mi">0</span><span class="p">]);</span>

<span class="n">shp</span> <span class="o">=</span> <span class="n">shp</span><span class="o">.</span><span class="n">rebuild</span><span class="p">();</span>

<span class="c1">%% model class</span>
<span class="n">mdl</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">shp</span><span class="p">,</span><span class="s1">'TimeStep'</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="s1">'TimeEnd'</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>

<span class="c1">%% class build + controller</span>
<span class="n">qd</span> <span class="o">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">qd</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="n">mm</span><span class="p">;</span>
<span class="n">qd</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span><span class="o">*</span><span class="n">mm</span><span class="p">;</span>
<span class="n">qd</span><span class="p">(</span><span class="mi">5</span><span class="p">,:)</span> <span class="o">=</span> <span class="o">-</span><span class="mi">7</span><span class="o">*</span><span class="n">mm</span><span class="p">;</span>
<span class="n">qd</span><span class="p">(</span><span class="mi">6</span><span class="p">,:)</span> <span class="o">=</span> <span class="o">-</span><span class="mi">7</span><span class="o">*</span><span class="n">mm</span><span class="p">;</span>

<span class="n">mdl</span><span class="o">.</span><span class="n">tau</span>  <span class="o">=</span> <span class="o">@</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="n">Controller</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">qd</span><span class="p">);</span>

<span class="c1">%% simulate</span>
<span class="n">mdl</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">simulate</span><span class="p">();</span> 

<span class="c1">% plotting</span>
<span class="nb">figure</span><span class="p">(</span><span class="mi">99</span><span class="p">);</span> <span class="nb">clf</span><span class="p">;</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="nb">plot</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">mdl</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">q</span><span class="p">,</span><span class="s1">'Linew'</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> <span class="nb">hold</span> <span class="n">on</span><span class="p">;</span>
<span class="nb">plot</span><span class="p">([</span><span class="mi">0</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">10</span><span class="p">],[</span><span class="n">qd</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">qd</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">qd</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="n">qd</span><span class="p">(:,</span><span class="mi">2</span><span class="p">)],</span><span class="s1">'k--'</span><span class="p">,</span><span class="s1">'Linew'</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">grid</span> <span class="n">on</span><span class="p">;</span> <span class="nb">title</span><span class="p">(</span><span class="s1">'states $q$'</span><span class="p">,</span><span class="s1">'interpreter'</span><span class="p">,</span><span class="s1">'latex'</span><span class="p">,</span><span class="s1">'fontsize'</span><span class="p">,</span><span class="mi">21</span><span class="p">)</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> <span class="nb">plot</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">mdl</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="s1">'Linew'</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="nb">grid</span> <span class="n">on</span><span class="p">;</span> <span class="nb">title</span><span class="p">(</span><span class="s1">'momenta $p = M(q)\dot{q}$'</span><span class="p">,</span><span class="s1">'interpreter'</span><span class="p">,</span><span class="s1">'latex'</span><span class="p">,</span><span class="k">...</span>
    <span class="s1">'fontsize'</span><span class="p">,</span><span class="mi">21</span><span class="p">);</span>
<span class="n">sorocolor</span>

<span class="c1">%% animation</span>
<span class="nb">figure</span><span class="p">(</span><span class="mi">101</span><span class="p">);</span> <span class="nb">clf</span><span class="p">;</span>
<span class="n">rig</span> <span class="o">=</span> <span class="n">setupRig</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">Modes</span><span class="p">);</span>

<span class="k">for</span> <span class="n">ii</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">fps</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">FPS</span><span class="p">):</span><span class="nb">length</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>

    <span class="n">rig</span> <span class="o">=</span> <span class="n">rig</span><span class="o">.</span><span class="n">computeFK</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">q</span><span class="p">(</span><span class="n">ii</span><span class="p">,:));</span>
    <span class="n">rig</span> <span class="o">=</span> <span class="n">rig</span><span class="o">.</span><span class="n">update</span><span class="p">();</span>
  
    <span class="nb">axis</span><span class="p">([</span><span class="o">-.</span><span class="mi">1</span><span class="o">*</span><span class="n">L</span> <span class="o">.</span><span class="mi">1</span><span class="o">*</span><span class="n">L</span> <span class="o">-.</span><span class="mi">1</span><span class="o">*</span><span class="n">L</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">L</span> <span class="o">-</span><span class="mf">1.2</span><span class="o">*</span><span class="n">L</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">L</span><span class="p">]);</span>
    <span class="nb">view</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">15</span><span class="p">);</span>
    <span class="nb">zoom</span><span class="p">(</span><span class="mf">1.2</span><span class="p">);</span>
    <span class="nb">drawnow</span><span class="p">();</span>
    <span class="n">background</span><span class="p">();</span>
<span class="k">end</span>

<span class="c1">%% setup controller</span>
<span class="k">function</span> <span class="n">tau</span> <span class="o">=</span> <span class="n">Controller</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span><span class="n">Qd</span><span class="p">)</span>
<span class="n">t</span>   <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">t</span><span class="p">;</span>
<span class="n">q</span>   <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">q</span><span class="p">;</span>
<span class="n">dq</span>  <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">dq</span><span class="p">;</span>

<span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">5</span>
    <span class="n">qd</span> <span class="o">=</span> <span class="n">Qd</span><span class="p">(:,</span><span class="mi">1</span><span class="p">);</span>
<span class="k">else</span>
    <span class="n">qd</span> <span class="o">=</span> <span class="n">Qd</span><span class="p">(:,</span><span class="mi">2</span><span class="p">);</span>
<span class="k">end</span>

<span class="n">KT</span>  <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">EL</span><span class="o">.</span><span class="n">K</span><span class="p">;</span>
<span class="n">Kd</span>  <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">EL</span><span class="o">.</span><span class="n">M</span><span class="p">;</span>
<span class="n">tau</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">dUdq</span> <span class="o">-</span> <span class="n">KT</span><span class="o">*</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="n">qd</span><span class="p">)</span> <span class="o">-</span> <span class="n">Kd</span><span class="o">*</span><span class="n">dq</span><span class="p">;</span>
<span class="k">end</span>

<span class="c1">%% setup rig</span>
<span class="k">function</span> <span class="n">rig</span> <span class="o">=</span> <span class="n">setupRig</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">Modes</span><span class="p">)</span>
<span class="n">gmdl1</span> <span class="o">=</span> <span class="n">Gmodel</span><span class="p">(</span><span class="s1">'Pneulink.stl'</span><span class="p">,</span><span class="s1">'ShowProcess'</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="n">gmdl2</span> <span class="o">=</span> <span class="n">gmdl1</span><span class="o">.</span><span class="nb">copy</span><span class="p">();</span>
<span class="n">gmdl3</span> <span class="o">=</span> <span class="n">gmdl1</span><span class="o">.</span><span class="nb">copy</span><span class="p">();</span>

<span class="n">gmdl1</span> <span class="o">=</span> <span class="n">Blender</span><span class="p">(</span><span class="n">gmdl1</span><span class="p">,</span><span class="s1">'Loft'</span><span class="p">,[</span><span class="mf">1.00</span><span class="p">,</span><span class="mf">0.96</span><span class="p">]);</span>
<span class="n">gmdl2</span> <span class="o">=</span> <span class="n">Blender</span><span class="p">(</span><span class="n">gmdl2</span><span class="p">,</span><span class="s1">'Loft'</span><span class="p">,[</span><span class="mf">0.96</span><span class="p">,</span><span class="mf">0.92</span><span class="p">]);</span>
<span class="n">gmdl3</span> <span class="o">=</span> <span class="n">Blender</span><span class="p">(</span><span class="n">gmdl3</span><span class="p">,</span><span class="s1">'Loft'</span><span class="p">,[</span><span class="mf">0.92</span><span class="p">,</span><span class="mf">0.88</span><span class="p">]);</span>

<span class="n">gmdl4</span> <span class="o">=</span> <span class="n">Gmodel</span><span class="p">(</span><span class="s1">'SoftGripperRedux.stl'</span><span class="p">,</span><span class="s1">'ShowProcess'</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="n">gmdl4</span> <span class="o">=</span> <span class="n">Blender</span><span class="p">(</span><span class="n">gmdl4</span><span class="p">,</span><span class="s1">'Scale'</span><span class="p">,</span><span class="mf">0.88</span><span class="p">);</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
<span class="n">X</span> <span class="o">=</span> <span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="o">'</span><span class="p">;</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">GenerateFunctionSpace</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">L</span><span class="p">);</span>

<span class="n">shp</span> <span class="o">=</span> <span class="n">Shapes</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">Modes</span><span class="p">,</span><span class="s1">'L0'</span><span class="p">,</span><span class="n">L</span><span class="p">);</span>
 
<span class="n">rig</span> <span class="o">=</span> <span class="n">Rig</span><span class="p">(</span><span class="o">@</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">shp</span><span class="o">.</span><span class="nb">string</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s1">'Domain'</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="s1">'XTangent'</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>

<span class="n">rig</span> <span class="o">=</span> <span class="n">rig</span><span class="o">.</span><span class="nb">add</span><span class="p">(</span><span class="n">gmdl1</span><span class="p">,</span><span class="n">gmdl2</span><span class="p">,</span><span class="n">gmdl3</span><span class="p">,</span><span class="n">gmdl4</span><span class="p">);</span>

<span class="n">rig</span> <span class="o">=</span> <span class="n">rig</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="n">rig</span> <span class="o">=</span> <span class="n">rig</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.3</span><span class="p">);</span>
<span class="n">rig</span> <span class="o">=</span> <span class="n">rig</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.3</span><span class="p">);</span>
<span class="n">rig</span> <span class="o">=</span> <span class="n">rig</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">.</span><span class="mi">6</span><span class="p">);</span>
<span class="n">rig</span> <span class="o">=</span> <span class="n">rig</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">6</span><span class="p">);</span>
<span class="n">rig</span> <span class="o">=</span> <span class="n">rig</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">.</span><span class="mi">9</span><span class="p">);</span>
<span class="n">rig</span> <span class="o">=</span> <span class="n">rig</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">.</span><span class="mi">9</span><span class="p">);</span>

<span class="n">rig</span><span class="o">.</span><span class="n">g0</span> <span class="o">=</span> <span class="n">SE3</span><span class="p">(</span><span class="n">roty</span><span class="p">(</span><span class="o">-</span><span class="nb">pi</span><span class="p">),</span><span class="nb">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
<span class="n">rig</span> <span class="o">=</span> <span class="n">rig</span><span class="o">.</span><span class="n">render</span><span class="p">();</span>
<span class="k">end</span>
</code></pre></div></div>
<p class="fs-3"><a href="https://www.festo.com/group/en/cms/10241.htm"><strong>[1]</strong></a> <strong>Bionic Handling Assistant</strong> a soft robotic manipulator from Festo.</p>
<p class="fs-3"><a href="https://en.wikipedia.org/wiki/Gram%E2%80%93Schmidt_process"><strong>[2]</strong></a> <strong>Gram-Schmidt process</strong> on constructing a orthonormal basis.</p>
<hr>
<footer><p><a href="#top" id="back-to-top">Back to top</a></p>
<p class="text-small text-grey-dk-100 mb-0">Copyright © 2018-2022 Brandon Caasenbrood. Distributed by a <a href="https://github.com/BJCaasenbrood/SorotokiCode/tree/master/LICENSE.md">MIT license.</a></p>
<div class="d-flex mt-2"></div></footer>
</div>
</div>
<div class="search-overlay"></div>
</div>
</body>
</html>
